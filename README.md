# Rust-IME (Blind IME) 使用手册

这是一个高性能、基于 Linux 底层 (uinput) 的中文输入法引擎。其核心设计理念是：**“用已知的英文知识，换取零重码的盲打体验”**。

---

## 🛠 核心功能与特色

### 1. 英文辅码 (English Auxiliary Coding)
传统的形码（五笔等）需要记忆抽象的键位，而 Rust-IME 使用英文单词的首字母作为汉字的辅码。
- **原理**：`拼音` + `英文辅码首字母` = `唯一候选词`。
- **示例**：
    - 输入 `ni` (你/泥/尼...) -> 此时重码多。
    - 输入 `niM` (辅码 Mud 的首字母 M) -> 直接锁定“泥”。
    - **进阶**：如果首字母仍有冲突，可继续输入辅码。`niMu` -> 唯一。
- **辅助过滤**：输入拼音后，输入大写字母可直接进行辅码过滤（如 `niM`）。

### 2. 滑动窗口选词 (Sliding Window)
摒弃了传统的“翻页”模式，采用类似选词条“滚动”的逻辑：
- **`Tab`**: 选中下一个词，且整个列表下移一行（Sliding Down）。
- **`Shift + Tab`**: 选中上一个词，且列表上移一行（Sliding Up）。
- **`1-5`**: 直接选择当前屏幕上显示的第 1 至第 5 个词。
- **`- / =`**: 快速翻页（一次跳转 5 个词）。

### 3. 四声调过滤与纠错 (Tones)
支持通过数字 7, 8, 9, 0 快速过滤声调或进行输入纠错：
- `7`: 一声 (ā)
- `8`: 二声 (á)
- `9`: 三声 (ǎ)
- `0`: 四声 (à)
- **过滤用法**：输入 `ni9` -> 过滤出所有三声的同音字（你、拟等）。
- **智能纠错**：如果你输入的拼音拼写有误但声调正确（或输入了错误的声调），程序会尝试进行启发式匹配，通过声调锁定你真正想要的字。

### 4. N-gram 智能联想 (Intelligent Prediction)
内置 Bigram 二元语言模型，能够根据上下文自动预测下一个字，并优化候选词排序。
- **自动联想**：输入一个字后，候选词首位通常是根据前一个字计算出的最高频接续字。
- **动态组词**：输入 `nihao`，程序会自动将 `ni` 和 `hao` 的高频组合（如“你好”）置顶。

---

## 💻 命令行参数说明 (CLI Reference)

本程序支持多种运行模式，通过不同的参数触发：

### 核心运行模式
- **(无参数)**: 默认以 **Daemon (守护进程)** 模式运行。
- **`--foreground`**: 前台运行模式。适合调试。
- **`--train <文本文件>`**: **[新]** 训练 N-gram 模型。你可以提供自己的文章或聊天记录（txt格式），程序会学习你的用词习惯并保存到 `ngram.json`。
    - 示例：`rust-ime --train my_articles.txt`
- **`--stop`**: 停止后台进程。
- **`--restart`**: 重启服务。

### 工具与配置
- **`--config`** 或 **`-c`**: 启动 Web 配置中心。
- **`--reset-config`**: 重置配置。

---

## ⚙️ 配置文件 (config.json) 详解

### 重要配置项：
- **`input.enable_fuzzy_pinyin`**: 
    - `true`: 开启模糊拼音（如 z/zh, c/ch, s/sh 不分）。
    - `false`: 严格匹配模式（默认）。
- **`appearance.show_notifications`**: 是否在切换状态或候选词更新时显示系统桌面通知。
- **`appearance.preview_mode`**: 
    - `none`: 不显示预览。
    - `pinyin`: 在光标处预览拼音。
    - `hanzi`: 在光标处预览首选字（盲打推荐）。

---

## 🛡 运行权限与安全

1. **uinput 权限**：由于程序需要拦截底层按键，你的用户必须在 `input` 组：
   ```bash
   sudo usermod -aG input,uinput $USER
   # 修改后需要注销并重新登录
   ```
2. **Wayland 支持**：在 Wayland 环境下，如果剪贴板无法自动上屏，程序会自动降级使用 `ydotool` 进行模拟。请确保系统已安装 `ydotool` 并启动了 `ydotoold` 服务。

---

## 📊 词库开发与分析工具
- `analyze_aux.py`: 分析脚本。
- `dicts/chinese/character/level-1_uniqueness_report.txt`: 辅码唯一性分析报告。你可以通过查阅此报告，了解哪些字只需要 1 位辅码即可盲打。
