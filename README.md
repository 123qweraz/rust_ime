# Rust-IME (Blind IME) 使用手册

这是一个高性能、基于 Linux 底层 (uinput) 的中文输入法引擎。其核心设计理念是：**“用已知的英文知识，换取零重码的盲打体验”**。

---

## 🛠 核心功能与特色

### 1. 英文辅码 (English Auxiliary Coding)
传统的形码（五笔等）需要记忆抽象的键位，而 Rust-IME 使用英文单词的首字母作为汉字的辅码。
- **原理**：`拼音` + `英文辅码首字母` = `唯一候选词`。
- **示例**：
    - 输入 `ni` (你/泥/尼...) -> 此时重码多。
    - 输入 `niM` (辅码 Mud 的首字母 M) -> 直接锁定“泥”。
    - **进阶**：如果首字母仍有冲突，可继续输入辅码。`niMu` -> 唯一。
- **辅助过滤**：输入拼音后，输入大写字母可直接进行辅码过滤（如 `niM`）。

### 2. 滑动窗口选词 (Sliding Window)
摒弃了传统的“翻页”模式，采用类似选词条“滚动”的逻辑：
- **`Tab`**: 选中下一个词，且整个列表下移一行（Sliding Down）。
- **`Shift + Tab`**: 选中上一个词，且列表上移一行（Sliding Up）。
- **`1-5`**: 直接选择当前屏幕上显示的第 1 至第 5 个词。
- **`- / =`**: 快速翻页（一次跳转 5 个词）。

### 3. 四声调过滤 (Tones)
支持通过数字 7, 8, 9, 0 快速过滤声调：
- `7`: 一声 (ā)
- `8`: 二声 (á)
- `9`: 三声 (ǎ)
- `0`: 四声 (à)
- **用法**：输入 `ni9` -> 过滤出所有三声的同音字（你、拟等）。

---

## 💻 命令行参数说明 (CLI Reference)

本程序支持多种运行模式，通过不同的参数触发：

### 核心运行模式
- **(无参数)**: 默认以 **Daemon (守护进程)** 模式运行。程序会自动转入后台，PID 记录在 `/tmp/rust-ime.pid`，日志在 `/tmp/rust-ime.log`。
- **`--foreground`**: 前台运行模式。所有日志直接输出到终端，适合调试时查看按键抓取情况。
- **`--stop`**: 停止正在运行的后台 Daemon 进程。
- **`--restart`**: 重启后台进程。

### 工具与配置
- **`--config`** 或 **`-c`**: 启动 Web 配置中心。会在浏览器中打开 `http://localhost:8765`，你可以在这里：
    - 修改所有快捷键。
    - 在线编辑/增加词库。
    - 实时更新输入法配置。
- **`--install`**: 自动安装到系统的开机启动项 (`~/.config/autostart`)。
- **`--reset-config`**: 将 `config.json` 重置为默认出厂设置。
- **`--help`** 或 **`-h`**: 显示简要帮助信息。

### 命令行转换模式 (CLI Mode)
你可以直接在终端把 `rust-ime` 当作转换工具使用：
- **`rust-ime [拼音]`**: 在终端输出转换后的汉字（并自动复制到剪贴板）。
    - 示例：`rust-ime niH_ao` -> 输出：你好。
- **`rust-ime -a [拼音]`**: 显示所有匹配的候选词。
- **`rust-ime -l[页码] [拼音]`**: 分页列出候选词。

---

## ⚙️ 配置文件 (config.json) 详解

配置文件通常位于程序运行目录或 `~/.local/share/rust-ime/`。

### 重要配置项：
- **`files.char_defs`**: 英文辅码字典列表。默认仅加载 `level-1` (常用字)。如果需要更多生僻字，可以在此处添加 `level-2` 等路径。
- **`hotkeys.switch_language`**: 切换中英文的快捷键，默认 `caps_lock`。
- **`appearance.preview_mode`**: 
    - `none`: 不显示预览。
    - `pinyin`: 在光标处预览当前输入的拼音。
    - `hanzi`: 在光标处预览当前首选的汉字（推荐）。
- **`input.paste_method`**: 
    - `ctrl_v`: 标准模式。
    - `ctrl_shift_v`: 终端模式。
    - `shift_insert`: X11 兼容模式。

---

## 🛡 运行权限与安全

1. **uinput 权限**：由于程序需要拦截底层按键，你的用户必须在 `input` 组：
   ```bash
   sudo usermod -aG input,uinput $USER
   # 修改后需要注销并重新登录
   ```
2. **Wayland 支持**：在 Wayland 环境下，如果剪贴板无法自动上屏，程序会自动降级使用 `ydotool` 进行模拟。请确保系统已安装 `ydotool` 并启动了 `ydotoold` 服务。

---

## 📊 词库开发与分析工具
- `analyze_aux.py`: 分析脚本。
- `dicts/chinese/character/level-1_uniqueness_report.txt`: 辅码唯一性分析报告。你可以通过查阅此报告，了解哪些字只需要 1 位辅码即可盲打。
